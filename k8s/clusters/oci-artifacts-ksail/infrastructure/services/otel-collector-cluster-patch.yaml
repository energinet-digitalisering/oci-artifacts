apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: otel-collector-cluster
  namespace: otel-collector-k8s
spec:
  values:
    config:
      exporters:
        loki:
          endpoint: http://loki.loki:3100/loki/api/v1/push
          headers:
            x-scope-orgid: oci-artifacts-ksail

      processors:
        attributes/loki:
          actions:
            - action: insert
              key: loki.attribute.labels
              value: event.domain, k8s.resource.name

      service:
        pipelines:
          logs:
            exporters:
              - loki
              - debug
            processors:
              - attributes/loki
              - memory_limiter
              - batch
